!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function n(e){return`${("0"+e.getDate()).slice(-2)}.${("0"+(e.getMonth()+1)).slice(-2)}.${e.getFullYear()} ${("0"+e.getHours()).slice(-2)}:${("0"+e.getMinutes()).slice(-2)}`}function r(e,t){return Math.round(e/t)}function s(e){let t=[],i=[];!function n(r){const s=`https://ru.wikipedia.org/w/api.php?action=query&origin=*&prop=revisions&titles=${e[r]}&format=json`;$.ajax({url:s,type:"GET",success:e=>{if($.each(e.query.pages,(e,n)=>{let r=n.revisions[0].timestamp;t.push(r),i.push({title:n.title,date:r})}),0==r)return function(e,t){const i=e.reduce((e,t)=>e>t?e:t);$.each(e,(e,n)=>{if(t[e].date==i){let i=t[e].date.replace("T"," ");i=i.replace("Z"," "),$("#wiki-data").append($(`<p>Самая свежая статья - "${t[e].title}" была обновлена ${i}</p>`))}});const n=e.reduce((e,t)=>e<t?e:t);$.each(e,(e,i)=>{if(t[e].date==n){let i=t[e].date.replace("T"," ");i=i.replace("Z"," "),$("#wiki-data").append($(`<p>Самая старая статья - "${t[e].title}" была обновлена ${i}</p>`))}})}(t,i),0;n(--r)}})}(e.length-1)}function a(){const e=Date.now();let t=0;const i=n(new Date),a=document.getElementById("search-form__input");if(""==a.value)return void alert("Необходимо ввести текст в поле поиска!");let o=l(a.value);const u="http://ru.wikipedia.org/w/api.php?action=opensearch&origin=*&search="+encodeURI(o)+"&profile=strict&limit=5&format=json";$.ajax({url:u,type:"GET",success:n=>{if(0!=n[1].length){$("#wiki-items").empty();for(let e=0;e<n[1].length;e++)$("#wiki-items").append($('<h5><a href="'+n[3][e]+'">'+n[1][e]+"</a></h5>")),$("#wiki-items").append($("<p>"+n[2][e]+"</p>"));!function(e){let t=0;$("#wiki-data").empty(),function i(n){const s=`https://ru.wikipedia.org/w/api.php?format=json&action=query&origin=*&prop=extracts&explaintext=&titles=${e[n]}`;$.ajax({url:s,type:"GET",success:s=>{if($.each(s.query.pages,(e,i)=>{let n=i.extract;t+=n.length}),0==n){const i=r(t,e.length);return $("#wiki-data").append($(`<p>Среднее количество символов по выгруженным статьям - ${i}</p>`)),0}i(--n)}})}(e.length-1)}(n[1]),s(n[1]),t=Date.now()-e,function(e,t,i){let n=[];if(null!==localStorage.getItem("queries")){const e=JSON.parse(localStorage.getItem("queries"));$.each(e,(e,t)=>{n.push(t)})}10==n.length&&n.shift(),n.push({query:e,queryTime:t,loadTime:i});const r=JSON.stringify(n);localStorage.setItem("queries",r)}(o,i,t)}else alert("Не найдено ни одной статьи:(")}})}function l(e){return e.replace(/[^\s-a-zA-ZА-Яа-яЁё]/gi,"")}function o(e){$("#wiki-queries tbody").empty(),$.each(e,(e,t)=>{const i='<tr class="userQuery"><td class="query">'+t.query+'</td><td class="queryTime">'+t.queryTime+'</td><td class="queryLoadTime">'+t.loadTime+"</td></tr>";$("#wiki-queries tbody").append($(i))})}function u(e){const t=e.find(".filter");e.find(".userQuery").each(function(e){let i=!0;$(this).find("td").each(function(e){t.eq(e).val()&&-1==$(this).html().toLowerCase().indexOf(t.eq(e).val().toLowerCase())&&(i=i&&!1)}),!0===i?$(this).css("display",""):$(this).css("display","none")})}i.r(t);let c=1,d=1,p=1;function y(e){let t=[];const i=document.getElementsByClassName("query"),n=document.getElementsByClassName("queryTime"),r=document.getElementsByClassName("queryLoadTime");$("#wiki-queries tbody tr").each((e,s)=>{t.push({query:i[e].textContent,queryTime:n[e].textContent,loadTime:r[e].textContent})}),"byQuery"==e&&(1!=c?t.reverse():t.sort((e,t)=>e.query.localeCompare(t.query)),c++,d=1,p=1),"byQueryTime"==e&&(1!=d?t.reverse():t.sort((e,t)=>e.queryTime.localeCompare(t.queryTime)),c=1,d++,p=1),"byQueryLoadTime"==e&&(1!=p?t.reverse():t.sort((e,t)=>e.loadTime-t.loadTime),c=1,d=1,p++),o(t),""!==$("#wiki-queries table").find(".filter").value&&u($("#wiki-queries table"))}const m=document.getElementById("wiki-items"),f=document.getElementById("wiki-queries"),g=document.getElementById("wiki-data"),h=document.getElementById("wiki-statistics");$(document).ready(()=>{let e=document.head,t=document.createElement("link");t.rel="stylesheet","dark"===localStorage.getItem("themeStyle")?t.href="../css/dark.css":t.href="../css/light.css",e.appendChild(t),$("#search-form").submit(e=>{e.preventDefault(),a(),m.style.display="block",f.style.display="none",g.style.display="block",h.style.display="none"}),$("#getOldQueries").on("click",()=>{o(JSON.parse(localStorage.getItem("queries"))),m.style.display="none",f.style.display="block",g.style.display="none",h.style.display="none"}),$("#sortQueries").on("click",()=>{y("byQuery")}),$("#sortQueriesTime").on("click",()=>{y("byQueryTime")}),$("#sortQueriesLoadTime").on("click",()=>{y("byQueryLoadTime")}),$(".filter").on("input",function(){u($(this).parents("table"))}),$("#getStatistics").on("click",()=>{!function(){$("#wiki-statistics").empty();const e=JSON.parse(localStorage.getItem("queries"));$.each(e,(e,t)=>{var i=document.createElement("div");i.style.height=`${t.loadTime}px`,i.textContent=`${t.query} - ${t.loadTime}`,$("#wiki-statistics").append($(i))})}(),m.style.display="none",f.style.display="none",g.style.display="none",h.style.display="flex"}),$("#switchStyle").on("click",()=>{"light"==localStorage.getItem("themeStyle")?(t.href="../css/dark.css",localStorage.setItem("themeStyle","dark")):(t.href="../css/light.css",localStorage.setItem("themeStyle","light"))}),QUnit.test("update string",function(e){e.equal(l("strin#g"),"string"),e.equal(l("!@s#$%tr^&*i&*(n#g)"),"string"),e.equal(l("str-in-g"),"str-in-g"),e.equal(l("str147`ing str-ng"),"string str-ng")}),QUnit.test("update date",function(e){const t=new Date(2011,0,1,12,34,0,0),i=new Date(2013,11,26),r=new Date(1356,0,1,0,7);e.equal(n(t),"01.01.2011 12:34"),e.equal(n(i),"26.12.2013 00:00"),e.equal(n(r),"01.01.1356 00:07")}),QUnit.test("calc average",function(e){e.equal(r(50,5),10),e.equal(r(3945,23),172)})})}]);