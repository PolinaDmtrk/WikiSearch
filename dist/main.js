!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function r(e){return`${("0"+e.getDate()).slice(-2)}.${("0"+(e.getMonth()+1)).slice(-2)}.${e.getFullYear()} ${("0"+e.getHours()).slice(-2)}:${("0"+e.getMinutes()).slice(-2)}`}async function n(e){const t=await fetch(e);return await t.json()}function s(e){const t=[],i=[],r=[];for(let i=0;i<e.length;i++)t.push(`https://ru.wikipedia.org/w/api.php?action=query&origin=*&prop=revisions&titles=${e[i]}&format=json`);Promise.all(t.map(async e=>n(e).then(e=>{const t=Object.keys(e.query.pages),n=e.query.pages[t[0]].revisions[0].timestamp;i.push(n),r.push({title:e.query.pages[t[0]].title,date:n})}).catch(e=>console.error("Error:",e)))).then(e=>{!function(e,t){let i=e.reduce((e,t)=>e>t?e:t),r=e.indexOf(i);i=i.replace("T"," ").replace("Z"," "),$("#wiki-data").append($(`<div><p>Самая свежая статья - "${t[r].title}" была обновлена ${i}</p></div>`));let n=e.reduce((e,t)=>e<t?e:t);r=e.indexOf(n),n=n.replace("T"," ").replace("Z"," "),$("#wiki-data").append($(`<div><p>Самая старая статья - "${t[r].title}" была обновлена ${n}</p></div>`))}(i,r)}).catch(e=>console.error("Error:",e))}function a(){const e=Date.now(),t=r(new Date),i=document.getElementById("search-form__input");if(""==i.value)return void alert("Необходимо ввести текст в поле поиска!");$("#wiki-items").empty(),$("#wiki-data").empty();const a=o(i.value);n("http://ru.wikipedia.org/w/api.php?action=opensearch&origin=*&search="+encodeURI(a)+"&profile=strict&limit=5&format=json").then(i=>{if(0==i[1].length)return void alert("Не найдено ни одной статьи:(");$("#wiki-items").empty();for(let e=0;e<i[1].length;e++){const t='<h5 class="article-name"><a href="'+i[3][e]+'">'+i[1][e]+'</a></h5><p class="article-description">'+i[2][e]+"</p>";$("#wiki-items").append($(`<div class="article">${t}<div>`))}!function(e){let t=0;const i=[];for(let t=0;t<e.length;t++)i.push(`https://ru.wikipedia.org/w/api.php?format=json&action=query&origin=*&prop=extracts&explaintext=&titles=${e[t]}`);Promise.all(i.map(async e=>n(e).then(e=>{const i=Object.keys(e.query.pages),r=e.query.pages[i[0]].extract;t+=r.length}).catch(e=>console.error("Error:",e)))).then(i=>{const r=Math.round(t/e.length);$("#wiki-data").append($(`<div><p>Среднее количество символов по выгруженным статьям - ${r}</p></div>`))}).catch(e=>console.error("Error:",e))}(i[1]),s(i[1]);const r=Date.now()-e;!function(e,t,i){const r=[];if(null!==localStorage.getItem("queries")){const e=JSON.parse(localStorage.getItem("queries"));$.each(e,(e,t)=>{r.push(t)})}10==r.length&&r.shift(),r.push({query:e,queryTime:t,queryLoadTime:i});const n=JSON.stringify(r);localStorage.setItem("queries",n)}(a,t,r)}).catch(e=>console.error("Error:",e))}function o(e){return e.replace(/[^\s-a-zA-ZА-Яа-яЁё]/gi,"")}function c(e){$("#wiki-queries tbody").empty(),$.each(e,(e,t)=>{const i=`<tr class="${t.trClass}"><td class="query">${t.query}</td><td class="queryTime">${t.queryTime}</td><td class="queryLoadTime">${t.queryLoadTime}</td></tr>`;$("#wiki-queries tbody").append($(i))})}i.r(t);let l="";const u=$("#wiki");$(document).ready(()=>{const e=document.head,t=document.createElement("link");t.rel="stylesheet",t.href=function(e){return"dark"==localStorage.getItem("themeStyle")?e.href="../css/dark.css":e.href="../css/light.css",e.href}(t),e.appendChild(t),$(".search-form").submit(e=>{e.preventDefault(),a(),$(u[0].children).each((e,t)=>{$(t).css("display","none")}),$("#wiki-items").css("display","block"),$("#wiki-data").css("display","block")}),$("#getOldQueries").on("click",()=>{$("#wiki-queries input").each((e,t)=>{t.value=""});const e=JSON.parse(localStorage.getItem("queries"));$(e).each((t,i)=>{e[t].trClass="userQuery"}),c(e),$(u[0].children).each((e,t)=>{$(t).css("display","none")}),$("#wiki-queries").css("display","block")}),$(".sort").on("click",function(){!function(e){const t=[];$("#wiki-queries tbody tr").each((e,i)=>{t[e]={},t[e].trClass=i.className,$("td",i).each((i,r)=>{t[e][r.className]=r.textContent})}),e==l?t.reverse():isNaN(Number(t[0][e]))?t.sort((t,i)=>t[e].localeCompare(i[e])):t.sort((e,t)=>e.queryLoadTime-t.queryLoadTime),l=e,c(t)}($(this)[0].parentElement.className)}),$(".filter").on("input",function(){!function(e){const t=e.find(".filter");e.find(".userQuery").each(function(){let e=!0;$(this).find("td").each(function(i){t.eq(i).val()&&-1==$(this).html().toLowerCase().indexOf(t.eq(i).val().toLowerCase())&&(e=e&&!1)}),!0===e?$(this).removeClass("non-visible"):$(this).addClass("non-visible")})}($(this).parents("table"))}),$("#getStatistics").on("click",()=>{!function(){$("#wiki-statistics").empty();const e=JSON.parse(localStorage.getItem("queries"));$.each(e,(e,t)=>{const i=document.createElement("div");i.style.height=`${t.queryLoadTime}px`,i.textContent=`${t.query} - ${t.queryLoadTime}`,$("#wiki-statistics").append($(i))})}(),$(u[0].children).each((e,t)=>{$(t).css("display","none")}),$("#wiki-statistics").css("display","flex")}),$("#switchStyle").on("click",()=>{!function(e){"light"==localStorage.getItem("themeStyle")?(e.href="../css/dark.css",localStorage.setItem("themeStyle","dark")):(e.href="../css/light.css",localStorage.setItem("themeStyle","light"))}(t)}),QUnit.test("update string",function(e){e.equal(o("strin#g"),"string"),e.equal(o("!@s#$%tr^&*i&*(n#g)"),"string"),e.equal(o("str-in-g"),"str-in-g"),e.equal(o("str147`ing str-ng"),"string str-ng")}),QUnit.test("update date",function(e){const t=new Date(2011,0,1,12,34,0,0),i=new Date(2013,11,26),n=new Date(1356,0,1,0,7);e.equal(r(t),"01.01.2011 12:34"),e.equal(r(i),"26.12.2013 00:00"),e.equal(r(n),"01.01.1356 00:07")})})}]);